google.charts.load("current",{packages:["corechart","bar","gauge","scatter"]});var wpDataTablesGoogleChart=function(){var t={rows:[],columns:[],type:"column",containerId:"google-chart-container",columnIndexes:[],connectedWPDataTable:null,chart:null,googleDataTable:null,renderCallback:null,options:{animation:{duration:1e3,easing:"out",startup:!0},backgroundColor:{fill:"#FFFFFF",strokeWidth:0,stroke:"#666",rx:0},chartArea:{backgroundColor:{}},crosshair:{},curveType:"none",fontName:"Arial",fontSize:null,hAxis:{direction:1},height:400,legend:{position:"right"},orientation:"horizontal",titlePosition:"out",tooltip:{trigger:"focus"},vAxis:{direction:1,viewWindow:{}}},setRows:function(t){this.rows=t},enableDateTimeAxis:function(){this.options.hAxis.gridlines={count:-1,units:{days:{format:["MMM dd"]},hours:{format:["HH:mm","ha"]}}}},detectDates:function(){for(var t in this.columns)if("date"==this.columns[t].type||"datetime"==this.columns[t].type)for(var e in this.rows){var o=Date.parse(this.rows[e][t]);if(isNaN(o))this.rows[e][t]=new Date;else if(this.rows[e][t]=new Date(o),null==this.connectedWPDataTable){var i=this.rows[e][t].getTime();"datetime"==this.columns[t].type&&(i+=60*this.rows[e][t].getTimezoneOffset()*1e3),this.rows[e][t].setTime(i)}else this.rows[e][t].setTime(this.rows[e][t].getTime());"datetime"==this.columns[t].type&&this.enableDateTimeAxis()}},setColumns:function(t){this.columns=t},getColumns:function(){return this.columns},setOptions:function(e){for(var o in e)"responsive_width"!=o||"1"!=e[o]?this.options[o]=e[o]:(t.options.animation=!1,jQuery(window).resize(function(){t.chart.draw(t.googleDataTable,t.options)}))},getOptions:function(){return this.options},setType:function(t){this.type=t},getType:function(){return this.type},setGrouping:function(t){this.group_chart=t},setContainer:function(t){this.containerId=t},getContainer:function(){return this.containerId},setRenderCallback:function(t){this.renderCallback=t},render:function(){for(var t in this.googleDataTable=new google.visualization.DataTable,this.columns)this.googleDataTable.addColumn(this.columns[t]);switch(this.detectDates(),this.googleDataTable.addRows(this.rows),this.type){case"google_column_chart":this.chart=new google.visualization.ColumnChart(document.getElementById(this.containerId));break;case"google_histogram":this.chart=new google.visualization.Histogram(document.getElementById(this.containerId));break;case"google_bar_chart":this.options.orientation="vertical",this.chart=new google.visualization.BarChart(document.getElementById(this.containerId));break;case"google_area_chart":this.chart=new google.visualization.AreaChart(document.getElementById(this.containerId));break;case"google_stepped_area_chart":this.options.isStacked=!0,this.chart=new google.visualization.SteppedAreaChart(document.getElementById(this.containerId));break;case"google_line_chart":this.chart=new google.visualization.LineChart(document.getElementById(this.containerId));break;case"google_pie_chart":this.chart=new google.visualization.PieChart(document.getElementById(this.containerId));break;case"google_bubble_chart":this.chart=new google.visualization.BubbleChart(document.getElementById(this.containerId));break;case"google_donut_chart":this.options.pieHole=.4,this.chart=new google.visualization.PieChart(document.getElementById(this.containerId));break;case"google_gauge_chart":this.options.redFrom=90,this.options.redTo=100,this.options.yellowFrom=75,this.options.yellowTo=90,this.options.minorTicks=5,this.chart=new google.visualization.Gauge(document.getElementById(this.containerId));break;case"google_scatter_chart":this.chart=new google.visualization.ScatterChart(document.getElementById(this.containerId));break;case"google_candlestick_chart":this.chart=new google.visualization.CandlestickChart(document.getElementById(this.containerId))}null!==this.renderCallback&&this.renderCallback(this),this.chart.draw(this.googleDataTable,this.options)},refresh:function(){if(void 0!==google.visualization.DataTable&&null!=this.chart){for(var t in this.googleDataTable=new google.visualization.DataTable,this.columns)this.googleDataTable.addColumn(this.columns[t]);this.detectDates(),this.googleDataTable.addRows(this.rows),null!==this.renderCallback&&this.renderCallback(this),this.chart.draw(this.googleDataTable,this.options)}},setConnectedWPDataTable:function(t){this.connectedWPDataTable=t},getConnectedWPDataTable:function(){return this.connectedWPDataTable},setChartConfig:function(e){1==e.responsive_width?(this.options.animation=!1,delete this.options.width,jQuery(window).resize(function(){t.chart.draw(t.googleDataTable,t.options)})):this.options.width=e.width,e.height&&(this.options.height=e.height),this.options.backgroundColor.fill=e.background_color,e.border_width&&(this.options.backgroundColor.strokeWidth=e.border_width),this.options.backgroundColor.stroke=e.border_color,e.border_radius&&(this.options.backgroundColor.rx=e.border_radius),e.border_radius&&(this.options.backgroundColor.rx=e.border_radius),this.options.chartArea.backgroundColor.fill=e.plot_background_color,e.plot_border_width&&(this.options.chartArea.backgroundColor.strokeWidth=e.plot_border_width),this.options.chartArea.backgroundColor.stroke=e.plot_border_color,e.font_size&&(this.options.fontSize=e.font_size),e.font_name&&(this.options.fontName=e.font_name),"google_pie_chart"==e.chart_type&&(1==e.three_d?this.options.is3D=!0:this.options.is3D=!1);var o=0;for(var i in e.series_data)this.columns[o+1].label=e.series_data[i].label,""!=e.series_data[i].color&&(this.options.series[o]={color:e.series_data[i].color}),o++;"google_line_chart"==e.chart_type&&(1==e.curve_type?this.options.curveType="function":this.options.curveType="none"),0==e.show_grid?(this.options.hAxis.gridlines={color:"transparent"},this.options.vAxis.gridlines={color:"transparent"}):(delete this.options.hAxis.gridlines,delete this.options.vAxis.gridlines),e.horizontal_axis_label&&(this.options.hAxis.title=e.horizontal_axis_label),1==e.horizontal_axis_crosshair&&0==e.vertical_axis_crosshair?this.options.crosshair={trigger:"both",orientation:"horizontal"}:0==e.horizontal_axis_crosshair&&1==e.vertical_axis_crosshair?this.options.crosshair={trigger:"both",orientation:"vertical"}:1==e.horizontal_axis_crosshair&&1==e.vertical_axis_crosshair?this.options.crosshair={trigger:"both",orientation:"both"}:this.options.crosshair={},e.horizontal_axis_direction&&(this.options.hAxis.direction=e.horizontal_axis_direction),e.vertical_axis_label&&(this.options.vAxis.title=e.vertical_axis_label),e.vertical_axis_direction&&(this.options.vAxis.direction=e.vertical_axis_direction),this.options.vAxis.viewWindow.min=e.vertical_axis_min,this.options.vAxis.viewWindow.max=e.vertical_axis_max,1==e.inverted?this.options.orientation="vertical":this.options.orientation="horizontal",1==e.show_title?this.options.title=e.chart_title:this.options.title="",1==e.title_floating?this.options.titlePosition="in":this.options.titlePosition="out",1==e.tooltip_enabled?this.options.tooltip.trigger="focus":this.options.tooltip.trigger="none",e.legend_position&&(this.options.legend.position=e.legend_position),"bottom"==e.legend_vertical_align?this.options.legend.alignment="end":"middle"==e.legend_vertical_align?this.options.legend.alignment="center":this.options.legend.alignment="start"},enableFollowFiltering:function(){null!=this.connectedWPDataTable&&this.connectedWPDataTable.fnSettings().aoDrawCallback.push({sName:"chart_filter_follow",fn:function(e){var o=[];t.options.animation=!1;var i=t.connectedWPDataTable._("tr",{filter:"applied"}).toArray(),n=jQuery.parseJSON(jQuery("#"+t.connectedWPDataTable.data("described-by")).val()).datepickFormat,a=jQuery.parseJSON(jQuery("#"+t.connectedWPDataTable.data("described-by")).val()).timeFormat,s=n.replace("dd","DD").replace("M","MMM").replace("mm","MM").replace("yy","YYYY"),r=s+" "+a.replace("H","H").replace("i","mm"),l=jQuery.parseJSON(jQuery("#"+t.connectedWPDataTable.data("described-by")).val()).number_format;for(var h in i){var c=[];for(var d in t.columnIndexes)if("number"==t.columns[d].type){var g=i[h][t.columnIndexes[d]];if(isNaN(g)){if(1==l)var u=".",p=",";else u=",",p=".";g=wdtUnformatNumber(g,u,p,!0)}c.push(parseFloat(g))}else"date"==t.columns[d].type?c.push(moment(i[h][t.columnIndexes[d]],s).toDate()):"datetime"==t.columns[d].type?(c.push(moment(i[h][t.columnIndexes[d]],r).toDate()),t.enableDateTimeAxis()):c.push(i[h][t.columnIndexes[d]]);o.push(c)}if(1==t.group_chart){var m=[];for(var h in o)if(void 0!==m&&m.length>0){var _="none";for(var d in m)"none"===_&&m[d][0]==o[h][0]&&(_=d);if("none"===_)m.push(o[h]);else for(var b in o[h])0!=b&&(m[_][b]+=o[h][b])}else m.push(o[h]);o=m}t.rows=o,t.refresh()}})},setColumnIndexes:function(t){this.columnIndexes=t},getColumnIndexes:function(){return this.columnIndexes}};return t};